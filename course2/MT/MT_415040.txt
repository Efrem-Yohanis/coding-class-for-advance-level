Note :To avoid duplicate login and create a new deal has NOT been included 

Test Case 415040: Verify the validation results for ABSEE deal


Test case name

Verify the validation results for ABSEE deal

Manual test case - Steps and Expected Results

Precondition: The user is logged in (see shared steps 413501) and the ABSEE deal under test has been created and uploaded.

Steps:
1. Go to the ABS-EE Deal Home page and locate the newly created deal row.
   - Expected: The deal row is visible and shows actions (e.g., "View", "Delete").
2. Click the "View" action for the deal.
   - Expected: The ABSEE Deal details page opens and the "Perform Validation" button is displayed.
3. Click "Perform Validation".
   - Expected: The "Select pair for validation" dialog appears and the user can select a radio option and use OK/Cancel.
4. Open the "Execution Status" tab and wait for validation to complete.
   - Expected: A message such as "ABS-EE Validation completed" and "CompletedSuccessfully" (or equivalent) is displayed.
5. Verify the "Validation Results" button is enabled and clickable.
   - Expected: The button is clickable.
6. Click "Validation Results" to download the result.
   - Expected: A .zip file is downloaded and the filename matches the expected validation result pattern (contains "validation" or ends with ".zip").

Notes:
- Avoid repeating login steps to prevent duplicate sessions.
- When asserting completion messages, allow an appropriate timeout to accommodate background processing.
import { test, expect } from '@playwright/test';

test('415040 - Verify validation results for ABS-EE deal', async ({ page }) => {
  const dealRowName = '548678 ar 29489 09-30-2024 01';

  // Go to ABS-EE Deal Home
  await page.getByRole('button', { name: 'ABS-EE Deal Home' }).click();
  await expect(page.getByRole('heading', { name: 'ABS-EE Deal Home' })).toBeVisible();

  // Open deal details
  await page.getByRole('row', { name: dealRowName }).getByRole('link', { name: /view/i }).click();
  await expect(page.getByRole('button', { name: 'Perform Validation' })).toBeVisible();

  // Perform validation
  await page.getByRole('button', { name: 'Perform Validation' }).click();
  await expect(page.getByText('Select pair for validation')).toBeVisible();
  // Select the first available radio option and confirm
  const firstRadio = page.getByRole('radio').first();
  await firstRadio.check();
  await page.getByRole('button', { name: /ok|confirm/i }).click();

  // Wait for completion in Execution Status
  await page.getByText('Execution Status').click();
  await expect(page.getByText(/ABS-EE Validation completed/i)).toBeVisible({ timeout: 60_000 });
  await expect(page.getByText(/CompletedSuccessfully/i)).toBeVisible({ timeout: 60_000 });

  // Download validation results and assert filename
  const validationBtn = page.getByRole('button', { name: 'Validation Results' });
  await expect(validationBtn).toBeEnabled();

  const [download] = await Promise.all([
    page.waitForEvent('download'),
    validationBtn.click(),
  ]);

  const suggested = download.suggestedFilename();
  expect(suggested).toMatch(/validation.*\.zip/i);
  // Optionally save the download locally
  await download.saveAs(suggested);
});
